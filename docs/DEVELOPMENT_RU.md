# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç comprehensive –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º Auto.ru GraphQL Federation.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã](#–Ω–∞—á–∞–ª–æ-—Ä–∞–±–æ—Ç—ã)
- [–°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#—Å—Ä–µ–¥–∞-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#—Ä–∞–±–æ—á–∏–π-–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–Ω–æ–≤—ã—Ö-—Ñ—É–Ω–∫—Ü–∏–π)
- [–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#—Å—Ç—Ä–∞—Ç–µ–≥–∏—è-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- [–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞](#–∫–∞—á–µ—Å—Ç–≤–æ-–∫–æ–¥–∞)
- [–û—Ç–ª–∞–¥–∫–∞](#–æ—Ç–ª–∞–¥–∫–∞)
- [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Rust**: 1.75+ (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ [rustup](https://rustup.rs/))
- **Docker**: 20.10+ —Å Docker Compose 2.0+
- **Node.js**: 18+ (–¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º)
- **Git**: –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- **IDE**: VS Code —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º Rust Analyzer (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd auto-ru-graphql-federation

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Rust toolchain –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
rustup component add rustfmt clippy

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
cargo install cargo-watch cargo-audit sqlx-cli

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make setup

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
make check
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è IDE

#### –†–∞—Å—à–∏—Ä–µ–Ω–∏—è VS Code
- **rust-analyzer**: –Ø–∑—ã–∫–æ–≤–æ–π —Å–µ—Ä–≤–µ—Ä Rust
- **GraphQL**: –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ GraphQL
- **Docker**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker
- **YAML**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–∞ YAML
- **GitLens**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Git

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VS Code (.vscode/settings.json)
```json
{
  "rust-analyzer.cargo.features": "all",
  "rust-analyzer.checkOnSave.command": "clippy",
  "rust-analyzer.inlayHints.enable": true,
  "files.watcherExclude": {
    "**/target/**": true
  },
  "graphql.useSchemaFileForIntrospection": true
}
```

## –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –†–µ–∂–∏–º—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### 1. –ü–æ–ª–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ Docker
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –≤ Docker
make start-dev

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make logs-ugc
make logs-router
```

#### 2. –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Docker
make start-infra

# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤ –¥–ª—è –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
make dev-ugc    # –¢–µ—Ä–º–∏–Ω–∞–ª 1
make dev-users  # –¢–µ—Ä–º–∏–Ω–∞–ª 2
make dev-offers # –¢–µ—Ä–º–∏–Ω–∞–ª 3

# –ó–∞–ø—É—Å–∫ —Ä–æ—É—Ç–µ—Ä–∞
make start-router
```

#### 3. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d postgres redis elasticsearch

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
export DATABASE_URL="postgresql://postgres:password@localhost:5432/ugc_db"
export REDIS_URL="redis://localhost:6379"

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
cd ugc-subgraph && cargo run
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
UGC_DATABASE_URL=postgresql://postgres:password@localhost:5432/ugc_db
USERS_DATABASE_URL=postgresql://postgres:password@localhost:5433/users_db
OFFERS_DATABASE_URL=postgresql://postgres:password@localhost:5434/offers_db
CATALOG_DATABASE_URL=postgresql://postgres:password@localhost:5435/catalog_db

# –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
REDIS_URL=redis://localhost:6379
ELASTICSEARCH_URL=http://localhost:9200

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
JWT_SECRET=dev-secret-key-change-in-production

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
RUST_LOG=debug
RUST_BACKTRACE=1

# –§–ª–∞–≥–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
ENVIRONMENT=development
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
auto-ru-graphql-federation/
‚îú‚îÄ‚îÄ Cargo.toml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è workspace
‚îú‚îÄ‚îÄ Makefile                   # –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ docker-compose.yml         # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ router.yaml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Apollo Router
‚îú‚îÄ‚îÄ .github/workflows/        # CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
‚îú‚îÄ‚îÄ docs/                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ scripts/                  # –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ schemas/                  # GraphQL —Å—Ö–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ ugc-subgraph/             # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.rs           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.rs         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.rs       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error.rs          # –¢–∏–ø—ã –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ graphql/          # GraphQL —Å—Ö–µ–º–∞ –∏ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/       # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
‚îÇ
‚îú‚îÄ‚îÄ users-subgraph/          # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ offers-subgraph/         # –°–µ—Ä–≤–∏—Å –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
‚îú‚îÄ‚îÄ catalog-subgraph/        # –°–µ—Ä–≤–∏—Å –∫–∞—Ç–∞–ª–æ–≥–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
‚îî‚îÄ‚îÄ search-subgraph/         # –°–µ—Ä–≤–∏—Å –ø–æ–∏—Å–∫–∞
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–≥—Ä–∞—Ñ–∞

–ö–∞–∂–¥—ã–π –ø–æ–¥–≥—Ä–∞—Ñ —Å–ª–µ–¥—É–µ—Ç —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

```
src/
‚îú‚îÄ‚îÄ main.rs                   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.rs                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database.rs               # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ error.rs                  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ health.rs                 # –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
‚îú‚îÄ‚îÄ telemetry.rs             # –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
‚îÇ
‚îú‚îÄ‚îÄ graphql/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs               # GraphQL —Å—Ö–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ query.rs             # Query —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ mutation.rs          # Mutation —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ subscription.rs      # Subscription —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ types.rs             # GraphQL —Ç–∏–ø—ã
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs               # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ review.rs            # –ú–æ–¥–µ–ª—å –æ—Ç–∑—ã–≤–∞
‚îÇ   ‚îî‚îÄ‚îÄ user.rs              # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs               # –¢—Ä–µ–π—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ review.rs            # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç–∑—ã–≤–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ user.rs              # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ
‚îî‚îÄ‚îÄ service/
    ‚îú‚îÄ‚îÄ mod.rs               # –°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤
    ‚îú‚îÄ‚îÄ review.rs            # –°–µ—Ä–≤–∏—Å –æ—Ç–∑—ã–≤–æ–≤
    ‚îî‚îÄ‚îÄ auth.rs              # –°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

## –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –ó–∞–ø—É—Å–∫ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make start-infra

# 2. –ó–∞–ø—É—Å–∫ –ø–æ–¥–≥—Ä–∞—Ñ–∞ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
cd ugc-subgraph
cargo watch -x run

# 3. –í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# –§–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

# 4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
cargo test

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
make clippy
make fmt
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏
git checkout -b feature/new-review-system

# 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
# ... –≤–Ω–µ—Å–∏—Ç–µ –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è ...

# 3. –ó–∞–ø—É—Å–∫ comprehensive —Ç–µ—Å—Ç–æ–≤
make test
make check

# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
# ... –æ–±–Ω–æ–≤–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é ...

# 5. –ö–æ–º–º–∏—Ç –∏ push
git add .
git commit -m "feat: implement new review system"
git push origin feature/new-review-system

# 6. –°–æ–∑–¥–∞–Ω–∏–µ pull request
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
cd ugc-subgraph
sqlx migrate add create_reviews_table

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
# migrations/001_create_reviews_table.sql

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
sqlx migrate run --database-url $UGC_DATABASE_URL

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
sqlx migrate revert --database-url $UGC_DATABASE_URL
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–¥–≥—Ä–∞—Ñ–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–¥–≥—Ä–∞—Ñ–∞**:
```bash
mkdir new-subgraph
cd new-subgraph
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ Cargo.toml**:
```toml
[package]
name = "new-subgraph"
version = "0.1.0"
edition = "2021"

[dependencies]
async-graphql = "6.0"
axum = "0.7"
tokio = { version = "1.0", features = ["full"] }
sqlx = { version = "0.7", features = ["runtime-tokio-rustls", "postgres", "uuid", "chrono"] }
# ... –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ workspace** (–∫–æ—Ä–Ω–µ–≤–æ–π Cargo.toml):
```toml
[workspace]
members = [
    "ugc-subgraph",
    "users-subgraph",
    "new-subgraph",  # –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
]
```

4. **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
```bash
mkdir -p src/{graphql,models,repository,service}
touch src/main.rs src/config.rs src/database.rs
```

5. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è GraphQL —Å—Ö–µ–º—ã**:
```rust
// src/graphql/mod.rs
use async_graphql::{Schema, Object, Result};

pub struct Query;

#[Object]
impl Query {
    async fn hello(&self) -> &str {
        "–ü—Ä–∏–≤–µ—Ç –æ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–¥–≥—Ä–∞—Ñ–∞!"
    }
}

pub type AppSchema = Schema<Query, EmptyMutation, EmptySubscription>;
```

6. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Docker Compose**:
```yaml
new-subgraph:
  build:
    context: .
    dockerfile: new-subgraph/Dockerfile
  ports:
    - "4006:4006"
  environment:
    - DATABASE_URL=postgresql://postgres:password@postgres:5432/new_db
```

7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–∞**:
```yaml
# router.yaml
subgraphs:
  new:
    routing_url: http://new-subgraph:4006/graphql
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ GraphQL —Ç–∏–ø–∞

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏**:
```rust
// src/models/product.rs
use serde::{Deserialize, Serialize};
use sqlx::FromRow;
use uuid::Uuid;

#[derive(Debug, Clone, FromRow, Serialize, Deserialize)]
pub struct Product {
    pub id: Uuid,
    pub name: String,
    pub description: Option<String>,
    pub price: i32,
    pub created_at: chrono::DateTime<chrono::Utc>,
}
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ GraphQL —Ç–∏–ø–∞**:
```rust
// src/graphql/types.rs
use async_graphql::{Object, ID};
use crate::models::Product as ProductModel;

#[Object]
impl ProductModel {
    async fn id(&self) -> ID {
        ID(self.id.to_string())
    }

    async fn name(&self) -> &str {
        &self.name
    }

    async fn description(&self) -> Option<&str> {
        self.description.as_deref()
    }

    async fn price(&self) -> i32 {
        self.price
    }
}
```

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**:
```rust
// src/repository/product.rs
use async_trait::async_trait;
use sqlx::PgPool;
use uuid::Uuid;
use crate::models::Product;

#[async_trait]
pub trait ProductRepository {
    async fn get_by_id(&self, id: Uuid) -> Result<Option<Product>>;
    async fn create(&self, product: CreateProductInput) -> Result<Product>;
}

pub struct PostgresProductRepository {
    pool: PgPool,
}

#[async_trait]
impl ProductRepository for PostgresProductRepository {
    async fn get_by_id(&self, id: Uuid) -> Result<Option<Product>> {
        let product = sqlx::query_as!(
            Product,
            "SELECT * FROM products WHERE id = $1",
            id
        )
        .fetch_optional(&self.pool)
        .await?;
        
        Ok(product)
    }
}
```

4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤**:
```rust
// src/graphql/query.rs
#[Object]
impl Query {
    async fn product(&self, ctx: &Context<'_>, id: ID) -> Result<Option<Product>> {
        let repository = ctx.data::<Arc<dyn ProductRepository>>()?;
        let product_id = Uuid::parse_str(&id)?;
        repository.get_by_id(product_id).await
    }
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤

1. **–°—É—â–Ω–æ—Å—Ç—å —Å –∫–ª—é—á–æ–º**:
```rust
use async_graphql::{Object, ID};

#[derive(async_graphql::SimpleObject)]
#[graphql(complex)]
pub struct Product {
    #[graphql(external)]
    pub id: ID,
    pub name: String,
}

#[ComplexObject]
impl Product {
    #[graphql(entity)]
    async fn find_by_id(ctx: &Context<'_>, id: ID) -> Result<Option<Product>> {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è reference —Ä–µ–∑–æ–ª–≤–µ—Ä–∞
    }
}
```

2. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Ç–∏–ø–æ–≤**:
```rust
#[derive(async_graphql::SimpleObject)]
#[graphql(extends)]
pub struct User {
    #[graphql(external)]
    pub id: ID,
    
    // –ù–æ–≤—ã–µ –ø–æ–ª—è, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —ç—Ç–∏–º –ø–æ–¥–≥—Ä–∞—Ñ–æ–º
    pub products: Vec<Product>,
}
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```rust
// src/service/review.rs
#[cfg(test)]
mod tests {
    use super::*;
    use mockall::predicate::*;

    #[tokio::test]
    async fn test_create_review() {
        let mut mock_repo = MockReviewRepository::new();
        mock_repo
            .expect_create()
            .with(eq(CreateReviewInput {
                offer_id: Uuid::new_v4(),
                rating: 5,
                text: "–û—Ç–ª–∏—á–Ω–æ!".to_string(),
            }))
            .times(1)
            .returning(|_| Ok(Review { /* ... */ }));

        let service = ReviewService::new(Arc::new(mock_repo));
        let result = service.create_review(input, user_id).await;
        
        assert!(result.is_ok());
    }
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```rust
// tests/integration_test.rs
use testcontainers::*;
use sqlx::PgPool;

#[tokio::test]
async fn test_review_creation_flow() {
    let docker = clients::Cli::default();
    let postgres = docker.run(images::postgres::Postgres::default());
    
    let database_url = format!(
        "postgresql://postgres:postgres@localhost:{}/postgres",
        postgres.get_host_port_ipv4(5432)
    );
    
    let pool = PgPool::connect(&database_url).await.unwrap();
    
    // –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
    sqlx::migrate!("./migrations").run(&pool).await.unwrap();
    
    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
    let service = ReviewService::new(pool);
    let result = service.create_review(input, user_id).await;
    
    assert!(result.is_ok());
}
```

### GraphQL —Ç–µ—Å—Ç—ã

```rust
// tests/graphql_test.rs
use async_graphql::*;

#[tokio::test]
async fn test_review_query() {
    let schema = create_test_schema().await;
    
    let query = r#"
        query GetReview($id: ID!) {
            review(id: $id) {
                id
                rating
                text
                author {
                    name
                }
            }
        }
    "#;
    
    let result = schema
        .execute(Request::new(query).variables(variables! {
            "id": "test-review-id"
        }))
        .await;
    
    assert!(result.errors.is_empty());
    assert!(result.data.is_some());
}
```

### End-to-End —Ç–µ—Å—Ç—ã

```bash
# tests/e2e/test_federation.sh
#!/bin/bash

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
./scripts/wait-for-services.sh

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "{ offers(first: 1) { edges { node { id reviews(first: 1) { edges { node { rating } } } } } } }"
  }' | jq '.errors // empty' | grep -q null

echo "E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!"
```## –ö–∞
—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –∫–æ–¥–∞
cargo fmt

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
cargo fmt -- --check
```

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
# –ó–∞–ø—É—Å–∫ clippy
cargo clippy -- -D warnings

# –ó–∞–ø—É—Å–∫ clippy —Å–æ –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
cargo clippy --all-features -- -D warnings
```

### –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cargo-audit
cargo install cargo-audit

# –ó–∞–ø—É—Å–∫ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
cargo audit

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
cargo audit --deny warnings
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ tarpaulin
cargo install cargo-tarpaulin

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
cargo tarpaulin --out Html --output-dir coverage/
```

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```rust
use tracing::{info, warn, error, debug, instrument};

#[instrument(skip(self), fields(user_id = %user_id))]
pub async fn create_review(&self, input: CreateReviewInput, user_id: Uuid) -> Result<Review> {
    info!("–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è {}", input.offer_id);
    
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    debug!("–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–∞");
    
    match self.repository.create(input, user_id).await {
        Ok(review) => {
            info!("–û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {}", review.id);
            Ok(review)
        }
        Err(e) => {
            error!("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ—Ç–∑—ã–≤: {}", e);
            Err(e)
        }
    }
}
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
export RUST_LOG=debug

# –í–∫–ª—é—á–µ–Ω–∏–µ backtraces
export RUST_BACKTRACE=1

# –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö backtraces
export RUST_BACKTRACE=full
```

### –û—Ç–ª–∞–¥–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```rust
// –í–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
use sqlx::postgres::PgPoolOptions;

let pool = PgPoolOptions::new()
    .max_connections(5)
    .connect(&database_url)
    .await?;

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
sqlx::query!("SELECT * FROM reviews WHERE id = $1", review_id)
    .fetch_one(&pool)
    .await?;
```

### –û—Ç–ª–∞–¥–∫–∞ GraphQL

```rust
use async_graphql::{Schema, extensions::Logger};

let schema = Schema::build(Query, Mutation, Subscription)
    .extension(Logger) // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
    .finish();
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**:
```rust
// –•–æ—Ä–æ—à–æ: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
sqlx::query_as!(Review, "SELECT * FROM reviews WHERE offer_id = $1", offer_id)
    .fetch_all(&pool)
    .await?;

// –ò–∑–±–µ–≥–∞–π—Ç–µ: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
let query = format!("SELECT * FROM reviews WHERE offer_id = '{}'", offer_id);
```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:
```sql
-- migrations/003_add_indexes.sql
CREATE INDEX idx_reviews_offer_id ON reviews(offer_id);
CREATE INDEX idx_reviews_author_id ON reviews(author_id);
CREATE INDEX idx_reviews_created_at ON reviews(created_at DESC);
```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**:
```rust
let pool = PgPoolOptions::new()
    .max_connections(20)
    .min_connections(5)
    .acquire_timeout(Duration::from_secs(30))
    .connect(&database_url)
    .await?;
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GraphQL

1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è DataLoader**:
```rust
use async_graphql::dataloader::*;

pub struct UserLoader {
    pool: PgPool,
}

#[async_trait::async_trait]
impl Loader<Uuid> for UserLoader {
    type Value = User;
    type Error = sqlx::Error;

    async fn load(&self, keys: &[Uuid]) -> Result<HashMap<Uuid, Self::Value>, Self::Error> {
        let users = sqlx::query_as!(
            User,
            "SELECT * FROM users WHERE id = ANY($1)",
            keys
        )
        .fetch_all(&self.pool)
        .await?;

        Ok(users.into_iter().map(|user| (user.id, user)).collect())
    }
}
```

2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤**:
```rust
use async_graphql::extensions::analyzer::*;

let schema = Schema::build(Query, Mutation, Subscription)
    .extension(Analyzer::new().depth_limit(10).complexity_limit(1000))
    .finish();
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```rust
use redis::AsyncCommands;

pub struct CacheService {
    client: redis::Client,
}

impl CacheService {
    pub async fn get_review(&self, id: Uuid) -> Result<Option<Review>> {
        let mut conn = self.client.get_async_connection().await?;
        let cached: Option<String> = conn.get(format!("review:{}", id)).await?;
        
        match cached {
            Some(data) => Ok(Some(serde_json::from_str(&data)?)),
            None => Ok(None),
        }
    }

    pub async fn set_review(&self, review: &Review) -> Result<()> {
        let mut conn = self.client.get_async_connection().await?;
        let data = serde_json::to_string(review)?;
        conn.set_ex(format!("review:{}", review.id), data, 3600).await?;
        Ok(())
    }
}
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫**:
```rust
use thiserror::Error;

#[derive(Error, Debug)]
pub enum ReviewError {
    #[error("–û—Ç–∑—ã–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω: {id}")]
    NotFound { id: Uuid },
    
    #[error("–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ—Ç–∑—ã–≤—É {id}")]
    Unauthorized { id: Uuid },
    
    #[error("–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {0}")]
    Database(#[from] sqlx::Error),
}
```

2. **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ GraphQL –æ—à–∏–±–∫–∏**:
```rust
impl From<ReviewError> for async_graphql::Error {
    fn from(err: ReviewError) -> Self {
        match err {
            ReviewError::NotFound { id } => {
                async_graphql::Error::new("–û—Ç–∑—ã–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω")
                    .extend_with(|_, e| e.set("code", "NOT_FOUND"))
                    .extend_with(|_, e| e.set("reviewId", id.to_string()))
            }
            // ... –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        }
    }
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
```rust
use validator::{Validate, ValidationError};

#[derive(Validate)]
pub struct CreateReviewInput {
    pub offer_id: Uuid,
    
    #[validate(range(min = 1, max = 5))]
    pub rating: i32,
    
    #[validate(length(min = 10, max = 1000))]
    pub text: String,
}
```

2. **–ì–∞—Ä–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
```rust
use async_graphql::{Guard, Context, Result};

pub struct RequireAuth;

#[async_trait::async_trait]
impl Guard for RequireAuth {
    async fn check(&self, ctx: &Context<'_>) -> Result<()> {
        match ctx.data_opt::<UserContext>() {
            Some(_) => Ok(()),
            None => Err("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è".into()),
        }
    }
}
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
```rust
use serde::Deserialize;

#[derive(Deserialize)]
pub struct Config {
    pub database_url: String,
    pub redis_url: String,
    pub jwt_secret: String,
    pub port: u16,
}

impl Config {
    pub fn from_env() -> Result<Self, envy::Error> {
        envy::from_env()
    }
}
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è GraphQL —Å—Ö–µ–º—ã**:
```rust
#[Object]
impl Query {
    /// –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤ –ø–æ ID
    /// 
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∑—ã–≤, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    /// –¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤.
    async fn review(
        &self,
        ctx: &Context<'_>,
        /// –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ç–∑—ã–≤–∞
        id: ID,
    ) -> Result<Option<Review>> {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }
}
```

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞**:
```rust
/// –°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –æ—Ç–∑—ã–≤–∞–º–∏ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏.
/// 
/// –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤, –≤–∫–ª—é—á–∞—è
/// –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º.
pub struct ReviewService {
    repository: Arc<dyn ReviewRepository>,
    cache: Arc<CacheService>,
}

impl ReviewService {
    /// –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
    /// 
    /// # –ê—Ä–≥—É–º–µ–Ω—Ç—ã
    /// 
    /// * `input` - –î–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
    /// * `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞—é—â–µ–≥–æ –æ—Ç–∑—ã–≤
    /// 
    /// # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç
    /// 
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ –∏–ª–∏ –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ —Å–æ–∑–¥–∞–Ω–∏—è.
    /// 
    /// # –û—à–∏–±–∫–∏
    /// 
    /// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏:
    /// - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
    /// - –û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    /// - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—Ä–æ—à–ª–∞
    pub async fn create_review(
        &self,
        input: CreateReviewInput,
        user_id: Uuid,
    ) -> Result<Review, ReviewError> {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }
}
```

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Makefile

```bash
# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev-start          # –ó–∞–ø—É—Å–∫ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev-stop           # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make dev-restart        # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make test-unit          # –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç–æ–≤
make test-integration   # –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
make test-e2e          # –ó–∞–ø—É—Å–∫ end-to-end —Ç–µ—Å—Ç–æ–≤
make test-all          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
make lint              # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º
make format            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make audit             # –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
make coverage          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
make db-migrate        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
make db-rollback       # –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
make db-reset          # –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make db-seed           # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

### –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ VS Code

```json
// .vscode/keybindings.json
[
  {
    "key": "ctrl+shift+t",
    "command": "workbench.action.terminal.new",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+r",
    "command": "rust-analyzer.run",
    "when": "editorTextFocus && editorLangId == rust"
  },
  {
    "key": "ctrl+shift+d",
    "command": "rust-analyzer.debug",
    "when": "editorTextFocus && editorLangId == rust"
  }
]
```

### –°–Ω–∏–ø–ø–µ—Ç—ã –∫–æ–¥–∞

```json
// .vscode/snippets/rust.json
{
  "GraphQL Object": {
    "prefix": "gql-object",
    "body": [
      "#[Object]",
      "impl ${1:TypeName} {",
      "    async fn ${2:field_name}(&self) -> ${3:ReturnType} {",
      "        ${4:// implementation}",
      "    }",
      "}"
    ],
    "description": "GraphQL Object implementation"
  },
  "Async Test": {
    "prefix": "async-test",
    "body": [
      "#[tokio::test]",
      "async fn ${1:test_name}() {",
      "    ${2:// test implementation}",
      "    assert!(${3:condition});",
      "}"
    ],
    "description": "Async test function"
  }
}
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç comprehensive –ø–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –æ—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ.

### üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –ø–æ–¥–≥—Ä–∞—Ñ –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Rust –∏ GraphQL –¥–ª—è end-to-end —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - comprehensive —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ GraphQL
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ best practices
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞ –∏ API

### üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
2. **–ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞** –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
4. **–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –∫–æ–¥–æ–≤–æ–π –±–∞–∑–æ–π
5. **–°–ª–µ–¥—É–π—Ç–µ best practices** –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–£–¥–∞—á–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üéâ