# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Apollo Router Federation

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç comprehensive —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Apollo Router Federation, –≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üìã –û–±–∑–æ—Ä

–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Apollo Router Federation –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω-—É—Ä–æ–≤–µ–Ω—å —Ç—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–∏–µ–º–ª–µ–º–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏. –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç:

- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```mermaid
graph TB
    subgraph "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
        K6[K6 Load Tests]
        Artillery[Artillery Tests]
        Rust[Rust Benchmarks]
    end
    
    subgraph "Apollo Router Federation"
        Router[Apollo Router<br/>:4000]
        UGC[UGC Subgraph<br/>:4001]
        Users[Users Subgraph<br/>:4002]
        Offers[Offers Subgraph<br/>:4004]
    end
    
    subgraph "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
        DB[(PostgreSQL)]
        Redis[(Redis Cache)]
        Monitoring[Prometheus/Jaeger]
    end
    
    K6 --> Router
    Artillery --> Router
    Rust --> UGC
    
    Router --> UGC
    Router --> Users
    Router --> Offers
    
    UGC --> DB
    UGC --> Redis
    
    Router --> Monitoring
    UGC --> Monitoring
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã (40% —Ç—Ä–∞—Ñ–∏–∫–∞)
–ë–∞–∑–æ–≤—ã–µ GraphQL –∑–∞–ø—Ä–æ—Å—ã, –Ω–∞—Ü–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–¥–≥—Ä–∞—Ñ—ã:

```graphql
query GetReview($id: ID!) {
  review(id: $id) {
    id
    rating
    text
    createdAt
  }
}
```

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: <100ms (P95)
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: >99.5%
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: >100 req/s

### 2. –§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (30% —Ç—Ä–∞—Ñ–∏–∫–∞)
–ó–∞–ø—Ä–æ—Å—ã, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤:

```graphql
query GetOfferWithReviews($offerId: ID!) {
  offer(id: $offerId) {
    id
    title
    price
    reviews(first: 10) {
      edges {
        node {
          id
          rating
          text
          author {
            id
            name
          }
        }
      }
    }
    averageRating
  }
}
```

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: <500ms (P95)
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: >99%
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: >50 req/s

### 3. –°–ª–æ–∂–Ω—ã–µ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (20% —Ç—Ä–∞—Ñ–∏–∫–∞)
–ì–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤:

```graphql
query ComplexFederatedQuery($first: Int!) {
  offers(first: $first) {
    edges {
      node {
        id
        title
        reviews(first: 5) {
          edges {
            node {
              id
              rating
              author {
                id
                name
                reviews(first: 3) {
                  edges {
                    node {
                      id
                      rating
                      offer {
                        id
                        title
                      }
                    }
                  }
                }
              }
            }
          }
        }
        averageRating
      }
    }
  }
}
```

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: <1000ms (P95)
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: >98%
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: >20 req/s

### 4. –ú—É—Ç–∞—Ü–∏–∏ (10% —Ç—Ä–∞—Ñ–∏–∫–∞)
–û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏, –∏–∑–º–µ–Ω—è—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

```graphql
mutation CreateReview($input: CreateReviewInput!) {
  createReview(input: $input) {
    id
    rating
    text
    author {
      id
      name
    }
    offer {
      id
      title
      averageRating
    }
  }
}
```

**–û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: <800ms (P95)
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: >99%
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: >10 req/s

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. K6 –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

K6 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è comprehensive –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö K6 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
./scripts/load-testing/run-load-tests.sh k6

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
K6_SCENARIO=federated k6 run scripts/load-testing/k6-load-tests.js

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
ROUTER_URL=http://localhost:4000 \
TEST_DURATION=600 \
k6 run scripts/load-testing/k6-load-tests.js
```

**–§–∞–∑—ã K6 —Ç–µ—Å—Ç–æ–≤:**
1. **–ë–∞–∑–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** 10 VUs –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
2. **–°–ø–∞–π–∫ —Ç–µ—Å—Ç:** –ù–∞—Ä–∞—Å—Ç–∞–Ω–∏–µ –æ—Ç 0 –¥–æ 100 VUs
3. **–°—Ç—Ä–µ—Å—Å —Ç–µ—Å—Ç:** 100 VUs –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç
4. **Soak —Ç–µ—Å—Ç:** 20 VUs –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç

### 2. Artillery –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

Artillery –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å–∫ Artillery —Ç–µ—Å—Ç–æ–≤
artillery run scripts/load-testing/artillery-load-tests.yml

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
artillery report artillery-results.json --output report.html
```

**–§–∞–∑—ã Artillery —Ç–µ—Å—Ç–æ–≤:**
1. **–†–∞–∑–æ–≥—Ä–µ–≤:** 5 req/s –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω—É—Ç—ã
2. **–ù–∞—Ä–∞—Å—Ç–∞–Ω–∏–µ:** 10-50 req/s –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
3. **–£—Å—Ç–æ–π—á–∏–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** 50 req/s –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç
4. **–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** 100 req/s –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–∏–Ω—É—Ç
5. **–°–Ω–∏–∂–µ–Ω–∏–µ:** 100-10 req/s –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –º–∏–Ω—É—Ç

### 3. Rust –±–µ–Ω—á–º–∞—Ä–∫–∏

–ú–∏–∫—Ä–æ-–±–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π –∫–æ–¥–∞:

```bash
# –ó–∞–ø—É—Å–∫ Rust –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
cd ugc-subgraph
cargo bench --bench review_benchmarks

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
cargo test --release --test performance_tests
```

## –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ K6
curl https://github.com/grafana/k6/releases/download/v0.47.0/k6-v0.47.0-linux-amd64.tar.gz -L | tar xvz --strip-components 1

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Artillery
npm install -g artillery

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
pip install matplotlib pandas seaborn
```

2. **–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:4000/health
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ comprehensive –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
./scripts/load-testing/run-load-tests.sh

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤
./scripts/load-testing/run-load-tests.sh k6
./scripts/load-testing/run-load-tests.sh artillery
./scripts/load-testing/run-load-tests.sh benchmarks
```

### –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
python3 scripts/load-testing/performance-analyzer.py ./load-test-results/20240829_143022

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
open load-test-results/20240829_143022/performance-report.html
```

## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (KPIs)

1. **–ú–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞:**
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
   - P95 –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (95-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å)
   - P99 –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (99-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å)
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

2. **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**
   - –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (RPS)
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:**
   - –£—Å–ø–µ—à–Ω–æ—Å—Ç—å (%)
   - –£—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ (%)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (%)

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (%)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (%)
   - –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
   - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –ü—Ä–∏–µ–º–ª–µ–º–æ | –ü–ª–æ—Ö–æ |
|---------|------|-----------|-------|
| P95 –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ | <500ms | <1000ms | >1000ms |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å | >99.5% | >99% | <99% |
| –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å | >100 RPS | >50 RPS | <50 RPS |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU | <70% | <85% | >85% |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ | <70% | <85% | >85% |
| –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à | >80% | >60% | <60% |

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–∞—Ç—Ç–µ—Ä–Ω DataLoader:**
```rust
// –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞—Ç—á–∏–Ω–≥–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
pub struct ReviewDataLoader {
    pool: PgPool,
}

impl ReviewDataLoader {
    pub async fn load_batch(&self, ids: Vec<Uuid>) -> Vec<Option<Review>> {
        // –ë–∞—Ç—á–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
        let reviews = sqlx::query_as!(
            Review,
            "SELECT * FROM reviews WHERE id = ANY($1)",
            &ids
        )
        .fetch_all(&self.pool)
        .await?;
        
        // –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ, —á—Ç–æ –∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ
        ids.into_iter()
            .map(|id| reviews.iter().find(|r| r.id == id).cloned())
            .collect()
    }
}
```

**–ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:**
```rust
// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
pub struct QueryComplexityAnalyzer {
    max_depth: usize,
    max_complexity: usize,
}

impl QueryComplexityAnalyzer {
    pub fn analyze(&self, query: &str) -> Result<(), QueryError> {
        let depth = self.calculate_depth(query);
        let complexity = self.calculate_complexity(query);
        
        if depth > self.max_depth {
            return Err(QueryError::TooDeep(depth));
        }
        
        if complexity > self.max_complexity {
            return Err(QueryError::TooComplex(complexity));
        }
        
        Ok(())
    }
}
```

### 2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

**Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```rust
// –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
pub struct CacheService {
    redis: redis::Client,
    default_ttl: Duration,
}

impl CacheService {
    pub async fn get_or_set<T>(&self, key: &str, fetcher: impl Future<Output = T>) -> T 
    where 
        T: Serialize + DeserializeOwned 
    {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–µ—à
        if let Ok(cached) = self.get::<T>(key).await {
            return cached;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –∏ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞—Ç—å
        let value = fetcher.await;
        let _ = self.set(key, &value, self.default_ttl).await;
        value
    }
}
```

**–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞:**
```rust
// –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞ –ø—Ä–∏ –º—É—Ç–∞—Ü–∏—è—Ö
impl ReviewService {
    pub async fn create_review(&self, input: CreateReviewInput) -> Result<Review, UgcError> {
        let review = self.repository.create_review(input).await?;
        
        // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–µ—à–µ–π
        self.cache.invalidate(&format!("offer_reviews:{}", input.offer_id)).await?;
        self.cache.invalidate(&format!("offer_rating:{}", input.offer_id)).await?;
        
        Ok(review)
    }
}
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ü—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**
```rust
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
let pool = PgPoolOptions::new()
    .max_connections(20)
    .min_connections(5)
    .acquire_timeout(Duration::from_secs(30))
    .idle_timeout(Duration::from_secs(600))
    .max_lifetime(Duration::from_secs(1800))
    .connect(&database_url)
    .await?;
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX CONCURRENTLY idx_reviews_offer_moderated_created 
ON reviews (offer_id, is_moderated, created_at DESC) 
WHERE is_moderated = true;

CREATE INDEX CONCURRENTLY idx_reviews_author_created 
ON reviews (author_id, created_at DESC) 
WHERE is_moderated = true;

-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE MATERIALIZED VIEW offer_rating_summary AS
SELECT 
    offer_id,
    AVG(rating) as average_rating,
    COUNT(*) as reviews_count,
    jsonb_object_agg(rating, rating_count) as rating_distribution
FROM (
    SELECT 
        offer_id,
        rating,
        COUNT(*) as rating_count
    FROM reviews 
    WHERE is_moderated = true
    GROUP BY offer_id, rating
) grouped
GROUP BY offer_id;

-- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
CREATE OR REPLACE FUNCTION refresh_rating_summary()
RETURNS void AS $
BEGIN
    REFRESH MATERIALIZED VIEW CONCURRENTLY offer_rating_summary;
END;
$ LANGUAGE plpgsql;
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏

**–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤:**
```rust
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤ —Å –ø—É–ª–∏–Ω–≥–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
pub struct SubgraphClient {
    client: reqwest::Client,
    base_url: String,
}

impl SubgraphClient {
    pub fn new(base_url: String) -> Self {
        let client = reqwest::Client::builder()
            .pool_max_idle_per_host(10)
            .pool_idle_timeout(Duration::from_secs(30))
            .timeout(Duration::from_secs(30))
            .build()
            .expect("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å HTTP –∫–ª–∏–µ–Ω—Ç");
        
        Self { client, base_url }
    }
}
```

**–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:**
```yaml
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Apollo Router –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
supergraph:
  query_planning:
    cache:
      in_memory:
        limit: 512
    experimental_reuse_query_fragments: true
  
subgraphs:
  ugc:
    routing_url: http://ugc-service:4001/graphql
    timeout: 30s
    retry:
      min_per_sec: 10
      ttl: 10s
```## –ú–æ–Ω–∏—Ç–æ—Ä
–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Prometheus –º–µ—Ç—Ä–∏–∫–∏:**
```rust
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
lazy_static! {
    static ref QUERY_DURATION: HistogramVec = register_histogram_vec!(
        "graphql_query_duration_seconds",
        "–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è GraphQL –∑–∞–ø—Ä–æ—Å–∞",
        &["operation_name", "subgraph"]
    ).unwrap();
    
    static ref FEDERATED_QUERIES: CounterVec = register_counter_vec!(
        "federated_queries_total",
        "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤",
        &["complexity_level"]
    ).unwrap();
    
    static ref CACHE_HITS: CounterVec = register_counter_vec!(
        "cache_hits_total",
        "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π/–ø—Ä–æ–º–∞—Ö–æ–≤ –∫–µ—à–∞",
        &["cache_type", "result"]
    ).unwrap();
}
```

**Grafana –¥–∞—à–±–æ—Ä–¥:**
```json
{
  "dashboard": {
    "title": "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Apollo Router Federation",
    "panels": [
      {
        "title": "–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (P95)",
        "type": "stat",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(graphql_query_duration_seconds_bucket[5m]))"
          }
        ]
      },
      {
        "title": "–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(graphql_queries_total[1m])"
          }
        ]
      },
      {
        "title": "–£—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(graphql_errors_total[1m]) / rate(graphql_queries_total[1m])"
          }
        ]
      }
    ]
  }
}
```

### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

```yaml
# –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ Prometheus
groups:
  - name: apollo_router_performance
    rules:
      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(graphql_query_duration_seconds_bucket[5m])) > 1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "–í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ GraphQL"
          description: "P95 –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}—Å"
      
      - alert: HighErrorRate
        expr: rate(graphql_errors_total[5m]) / rate(graphql_queries_total[5m]) > 0.05
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ GraphQL"
          description: "–£—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value | humanizePercentage }}"
      
      - alert: LowThroughput
        expr: rate(graphql_queries_total[5m]) < 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "–ù–∏–∑–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å GraphQL"
          description: "–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }} req/s"
```

## –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD

```yaml
# GitHub Actions workflow –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
name: Performance Tests
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  performance-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
        run: docker-compose up -d
      
      - name: –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
        run: |
          timeout 60 bash -c 'until curl -f http://localhost:4000/health; do sleep 2; done'
      
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ K6
        run: |
          curl https://github.com/grafana/k6/releases/download/v0.47.0/k6-v0.47.0-linux-amd64.tar.gz -L | tar xvz --strip-components 1
          sudo mv k6 /usr/local/bin/
      
      - name: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        run: |
          K6_SCENARIO=simple k6 run --quiet scripts/load-testing/k6-load-tests.js
      
      - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        run: |
          # –ü—Ä–æ–≤–∞–ª –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
          python3 scripts/check-performance-regression.py
```

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
import json
import sys

def check_performance_regression(current_results, baseline_results):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–∏ —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–≥—Ä–µ—Å—Å–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–µ–º–ª–µ–º—ã—Ö –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
    thresholds = {
        'p95_response_time': 1.2,  # –î–æ–ø—É—Å—Ç–∏–º–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –Ω–∞ 20%
        'success_rate': 0.99,      # –î–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è 99% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
        'throughput': 0.8          # –î–æ–ø—É—Å—Ç–∏–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ 20%
    }
    
    regressions = []
    
    for metric, threshold in thresholds.items():
        current = current_results.get(metric, 0)
        baseline = baseline_results.get(metric, 0)
        
        if metric == 'success_rate':
            if current < threshold:
                regressions.append(f"–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —É–ø–∞–ª–∞ –¥–æ {current:.2%}")
        elif metric == 'throughput':
            if current < baseline * threshold:
                regressions.append(f"–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–ø–∞–ª–∞ –¥–æ {current:.2f} (–±–∞–∑–æ–≤–∞—è: {baseline:.2f})")
        else:
            if current > baseline * threshold:
                regressions.append(f"{metric} —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å –¥–æ {current:.2f} (–±–∞–∑–æ–≤–∞—è: {baseline:.2f})")
    
    return regressions

if __name__ == '__main__':
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    with open('current-results.json') as f:
        current = json.load(f)
    
    with open('baseline-results.json') as f:
        baseline = json.load(f)
    
    regressions = check_performance_regression(current, baseline)
    
    if regressions:
        print("‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:")
        for regression in regressions:
            print(f"  - {regression}")
        sys.exit(1)
    else:
        print("‚úÖ –†–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã")
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–ù–∏–∑–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏

3. **–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ circuit breaker
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—à–∏–±–æ–∫

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
SELECT query, mean_time, calls, total_time 
FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Redis
redis-cli --latency-history -i 1

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
cargo flamegraph --bin ugc-subgraph

# –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–∏
tcpdump -i any -w network-trace.pcap port 4000

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
htop
iotop
nethogs
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
   - –û—Ç—Ä–∞–∂–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –í–∫–ª—é—á–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é —Å–µ—Ç–µ–≤—É—é –∑–∞–¥–µ—Ä–∂–∫—É
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

2. **–î–∏–∑–∞–π–Ω —Ç–µ—Å—Ç–æ–≤:**
   - –ù–∞—á–∏–Ω–∞—Ç—å —Å –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –í–∫–ª—é—á–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏

4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–º
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–∏

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ–≤ –∫–µ—à–∞
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à
   - –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è

3. **–§–µ–¥–µ—Ä–∞—Ü–∏—è:**
   - –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤
   - –ë–∞—Ç—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –∞–ª–µ—Ä—Ç–∏–Ω–≥
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç–µ–π

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ç–µ—Ö–Ω–∏–∫–∏

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
// K6 —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
import http from 'k6/http';
import { check, sleep } from 'k6';
import { Rate } from 'k6/metrics';

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
export let errorRate = new Rate('errors');

export let options = {
  stages: [
    { duration: '2m', target: 10 }, // –†–∞–∑–æ–≥—Ä–µ–≤
    { duration: '5m', target: 50 }, // –ù–∞—Ä–∞—Å—Ç–∞–Ω–∏–µ
    { duration: '10m', target: 100 }, // –°—Ç–∞–±–∏–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
    { duration: '3m', target: 200 }, // –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
    { duration: '5m', target: 0 }, // –°–Ω–∏–∂–µ–Ω–∏–µ
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'], // 95% –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ 500ms
    http_req_failed: ['rate<0.01'], // –ú–µ–Ω–µ–µ 1% –æ—à–∏–±–æ–∫
    errors: ['rate<0.01'], // –ú–µ–Ω–µ–µ 1% –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–æ–∫
  },
};

export default function() {
  // –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –æ—Ç–∑—ã–≤–∞ (40% —Ç—Ä–∞—Ñ–∏–∫–∞)
  if (Math.random() < 0.4) {
    let response = http.post('http://localhost:4000/graphql', JSON.stringify({
      query: `
        query GetReview($id: ID!) {
          review(id: $id) {
            id
            rating
            text
            createdAt
          }
        }
      `,
      variables: { id: `review-${Math.floor(Math.random() * 1000)}` }
    }), {
      headers: { 'Content-Type': 'application/json' },
    });
    
    check(response, {
      '—Å—Ç–∞—Ç—É—Å 200': (r) => r.status === 200,
      '–Ω–µ—Ç –æ—à–∏–±–æ–∫ GraphQL': (r) => !JSON.parse(r.body).errors,
    }) || errorRate.add(1);
  }
  
  // –°—Ü–µ–Ω–∞—Ä–∏–π 2: –§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å (30% —Ç—Ä–∞—Ñ–∏–∫–∞)
  else if (Math.random() < 0.7) {
    let response = http.post('http://localhost:4000/graphql', JSON.stringify({
      query: `
        query GetOfferWithReviews($offerId: ID!) {
          offer(id: $offerId) {
            id
            title
            price
            reviews(first: 10) {
              edges {
                node {
                  rating
                  text
                  author { name }
                }
              }
            }
            averageRating
          }
        }
      `,
      variables: { offerId: `offer-${Math.floor(Math.random() * 500)}` }
    }), {
      headers: { 'Content-Type': 'application/json' },
    });
    
    check(response, {
      '—Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω': (r) => r.status === 200 && !JSON.parse(r.body).errors,
      '–≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –ø—Ä–∏–µ–º–ª–µ–º–æ': (r) => r.timings.duration < 1000,
    }) || errorRate.add(1);
  }
  
  // –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú—É—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞ (10% —Ç—Ä–∞—Ñ–∏–∫–∞)
  else {
    let response = http.post('http://localhost:4000/graphql', JSON.stringify({
      query: `
        mutation CreateReview($input: CreateReviewInput!) {
          createReview(input: $input) {
            id
            rating
            text
          }
        }
      `,
      variables: {
        input: {
          offerId: `offer-${Math.floor(Math.random() * 500)}`,
          rating: Math.floor(Math.random() * 5) + 1,
          text: "–¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç–∑—ã–≤ –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
        }
      }
    }), {
      headers: { 
        'Content-Type': 'application/json',
        'Authorization': 'Bearer test-token'
      },
    });
    
    check(response, {
      '–º—É—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞': (r) => r.status === 200,
      '–æ—Ç–∑—ã–≤ —Å–æ–∑–¥–∞–Ω': (r) => JSON.parse(r.body).data?.createReview?.id,
    }) || errorRate.add(1);
  }
  
  sleep(1); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
}
```

### –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
import json
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime

class PerformanceAnalyzer:
    def __init__(self, results_file):
        with open(results_file, 'r') as f:
            self.results = json.load(f)
    
    def analyze_response_times(self):
        """–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞"""
        response_times = self.results.get('response_times', [])
        df = pd.DataFrame(response_times)
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        stats = {
            '—Å—Ä–µ–¥–Ω–µ–µ': df['duration'].mean(),
            '–º–µ–¥–∏–∞–Ω–∞': df['duration'].median(),
            'p95': df['duration'].quantile(0.95),
            'p99': df['duration'].quantile(0.99),
            '–º–∞–∫—Å–∏–º—É–º': df['duration'].max()
        }
        
        print("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞:")
        for metric, value in stats.items():
            print(f"  {metric}: {value:.2f}ms")
        
        # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        plt.figure(figsize=(12, 6))
        
        plt.subplot(1, 2, 1)
        plt.hist(df['duration'], bins=50, alpha=0.7)
        plt.title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞')
        plt.xlabel('–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (ms)')
        plt.ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
        
        plt.subplot(1, 2, 2)
        df['timestamp'] = pd.to_datetime(df['timestamp'])
        plt.plot(df['timestamp'], df['duration'])
        plt.title('–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏')
        plt.xlabel('–í—Ä–µ–º—è')
        plt.ylabel('–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (ms)')
        plt.xticks(rotation=45)
        
        plt.tight_layout()
        plt.savefig('response_times_analysis.png')
        plt.show()
        
        return stats
    
    def analyze_throughput(self):
        """–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"""
        requests = self.results.get('requests', [])
        df = pd.DataFrame(requests)
        df['timestamp'] = pd.to_datetime(df['timestamp'])
        
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–µ–∫—É–Ω–¥–∞–º
        df_grouped = df.groupby(df['timestamp'].dt.floor('S')).size()
        
        stats = {
            '—Å—Ä–µ–¥–Ω–∏–π_rps': df_grouped.mean(),
            '–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π_rps': df_grouped.max(),
            '–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π_rps': df_grouped.min()
        }
        
        print("üöÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:")
        for metric, value in stats.items():
            print(f"  {metric}: {value:.2f} req/s")
        
        # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        plt.figure(figsize=(12, 4))
        plt.plot(df_grouped.index, df_grouped.values)
        plt.title('–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–∏')
        plt.xlabel('–í—Ä–µ–º—è')
        plt.ylabel('–ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É')
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.savefig('throughput_analysis.png')
        plt.show()
        
        return stats
    
    def analyze_errors(self):
        """–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫"""
        errors = self.results.get('errors', [])
        if not errors:
            print("‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ!")
            return
        
        df = pd.DataFrame(errors)
        error_counts = df['type'].value_counts()
        
        print("‚ùå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫:")
        for error_type, count in error_counts.items():
            print(f"  {error_type}: {count}")
        
        # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        plt.figure(figsize=(10, 6))
        error_counts.plot(kind='bar')
        plt.title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫')
        plt.xlabel('–¢–∏–ø –æ—à–∏–±–∫–∏')
        plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ')
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.savefig('errors_analysis.png')
        plt.show()
    
    def generate_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è comprehensive –æ—Ç—á–µ—Ç–∞"""
        print("üìã –û—Ç—á–µ—Ç –æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏")
        print("=" * 50)
        
        response_stats = self.analyze_response_times()
        throughput_stats = self.analyze_throughput()
        self.analyze_errors()
        
        # –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        performance_grade = self.calculate_performance_grade(
            response_stats, throughput_stats
        )
        
        print(f"\nüéØ –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: {performance_grade}")
    
    def calculate_performance_grade(self, response_stats, throughput_stats):
        """–†–∞—Å—á–µ—Ç –æ–±—â–µ–π –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        score = 0
        
        # –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
        if response_stats['p95'] < 500:
            score += 40
        elif response_stats['p95'] < 1000:
            score += 25
        else:
            score += 10
        
        # –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        if throughput_stats['—Å—Ä–µ–¥–Ω–∏–π_rps'] > 100:
            score += 30
        elif throughput_stats['—Å—Ä–µ–¥–Ω–∏–π_rps'] > 50:
            score += 20
        else:
            score += 10
        
        # –û—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
        if len(self.results.get('errors', [])) == 0:
            score += 30
        elif len(self.results.get('errors', [])) < 10:
            score += 20
        else:
            score += 5
        
        if score >= 90:
            return "–û—Ç–ª–∏—á–Ω–æ üåü"
        elif score >= 70:
            return "–•–æ—Ä–æ—à–æ ‚úÖ"
        elif score >= 50:
            return "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ ‚ö†Ô∏è"
        else:
            return "–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è ‚ùå"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if __name__ == "__main__":
    analyzer = PerformanceAnalyzer('load_test_results.json')
    analyzer.generate_report()
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è essential –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Apollo Router Federation —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω —Ç—Ä–∞—Ñ–∏–∫. –°–ª–µ–¥—É—è —ç—Ç–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –∏ —Ä–µ–∞–ª–∏–∑—É—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –≤—ã –º–æ–∂–µ—Ç–µ:

- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ —Ä–µ—à–µ–Ω–∏—è, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–¥–µ–∂–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö –Ω–∞–≥—Ä—É–∑–∫–∏
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –±—É–¥—É—â–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –≤ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é –≤–∞—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

### üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–∞–≥—Ä—É–∑–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–£—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ